version: "3.9"
    
services:
  db:
    image: registry.gitlab.com/crim.ca/clients/ccdp/docker/db:latest
    volumes:
      - db_data:/var/lib/mysql
    restart: always
    environment:
      MARIADB_ROOT_PASSWORD: root
      MARIADB_DATABASE: climatedata
      MARIADB_USER: climatedata
      MARIADB_PASSWORD: climatedata
    command: --innodb-buffer-pool-size=128M --innodb-log-buffer-size=64M --innodb-doublewrite=0 --innodb-flush-log-at-trx-commit=0
    
  portal:
    depends_on:
      - db
    image: registry.gitlab.com/crim.ca/clients/ccdp/docker/portal:php82
    volumes:
      - ./climatedata-wp-theme:/var/www/html/site/assets/themes
    ports:
      - "443:443"
    hostname: dev.climatedata.ca
    restart: always

  sass:
    image: registry.gitlab.com/crim.ca/clients/ccdp/docker/sass:latest
    volumes:
      - ./climatedata-wp-theme:/climatedata-wp-theme
    restart: always
    command: sass -w /climatedata-wp-theme/fw-child/resources/scss/child.scss:/climatedata-wp-theme/fw-child/resources/css/child.css /climatedata-wp-theme/framework/resources/scss/framework.scss:/climatedata-wp-theme/framework/resources/css/framework.css /climatedata-wp-theme/framework/resources/scss/global.scss:climatedata-wp-theme/framework/resources/css/global.css

volumes:
  db_data: {}
